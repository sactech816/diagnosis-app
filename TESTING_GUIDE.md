# テストガイド - パスワードリセットと重複メール対応

## 概要
このドキュメントは、実装した「重複メール登録の改善」と「パスワードリセット機能の改善」のテスト手順を説明します。

---

## テスト環境の準備

### 必要なもの
1. 開発サーバーが起動していること
2. Supabaseの設定が完了していること
3. テスト用のメールアドレス（2つ以上推奨）
4. ブラウザの開発者ツール（コンソール確認用）

### 開発サーバーの起動
```bash
npm run dev
```

---

## テスト1: 重複メール登録の改善

### テストケース1-1: 新規メールアドレスでの登録（正常系）

**手順:**
1. アプリケーションを開く
2. 「新規登録」ボタンをクリック
3. 新しいメールアドレスとパスワードを入力
4. 「登録する」ボタンをクリック

**期待される結果:**
- ✅ 「確認メールを送信しました」というメッセージが表示される
- ✅ エラーが発生しない

---

### テストケース1-2: 既存メールアドレスでの登録試行（異常系）

**手順:**
1. アプリケーションを開く
2. 「新規登録」ボタンをクリック
3. **既に登録済み**のメールアドレスとパスワードを入力
4. 「登録する」ボタンをクリック

**期待される結果:**
- ✅ アラートメッセージが表示される
  ```
  このメールアドレスは既に登録されています。
  
  ログイン画面に切り替えます。
  パスワードを忘れた場合は「パスワードを忘れた方」をクリックしてください。
  ```
- ✅ アラートを閉じると、自動的にログイン画面に切り替わる
- ✅ メールアドレスは入力されたまま（保持される）
- ✅ パスワードフィールドは空になる

**確認ポイント:**
- [ ] エラーメッセージがわかりやすいか
- [ ] ログイン画面に自動切り替えされるか
- [ ] メールアドレスが保持されているか
- [ ] パスワードがクリアされているか

---

### テストケース1-3: ログイン画面からのログイン

**手順:**
1. テストケース1-2の続きから
2. パスワードを入力
3. 「ログイン」ボタンをクリック

**期待される結果:**
- ✅ ログインに成功する
- ✅ ダッシュボードにリダイレクトされる

---

## テスト2: パスワードリセット機能の改善

### テストケース2-1: パスワードリセットメールの送信（正常系）

**手順:**
1. ログイン画面を開く
2. 「パスワードを忘れた方」をクリック
3. 登録済みのメールアドレスを入力
4. 「リセットメールを送信」ボタンをクリック

**期待される結果:**
- ✅ 成功メッセージが表示される
- ✅ 送信先メールアドレスが表示される
- ✅ 以下の情報が表示される:
  - 📧 メール内のリンクをクリック
  - ⏰ メールが届かない場合の対処法
  - 💡 サポート連絡先
- ✅ 再送信ボタンが無効化されている
- ✅ カウントダウンが表示される（「再送信可能まで 60秒」）

**確認ポイント:**
- [ ] UIが見やすいか
- [ ] 情報が十分に提供されているか
- [ ] 色分けが適切か（緑、青、黄色）

---

### テストケース2-2: 再送信機能のテスト

**手順:**
1. テストケース2-1の続きから
2. 60秒待つ（またはカウントダウンを観察）
3. 「メールを再送信」ボタンをクリック

**期待される結果:**
- ✅ カウントダウンが1秒ごとに減少する
- ✅ 60秒後にボタンが有効化される
- ✅ ボタンのテキストが「メールを再送信」に変わる
- ✅ ボタンの色が緑色になる
- ✅ クリックすると「パスワードリセットメールを再送信しました」とアラート表示
- ✅ 再度60秒のクールダウンが始まる

**確認ポイント:**
- [ ] カウントダウンが正確に動作するか
- [ ] ボタンの有効/無効が正しく切り替わるか
- [ ] 再送信後、再度クールダウンが始まるか

---

### テストケース2-3: 存在しないメールアドレスでのリセット試行

**手順:**
1. パスワードリセット画面を開く
2. 存在しないメールアドレスを入力
3. 「リセットメールを送信」ボタンをクリック

**期待される結果:**
- ✅ 成功メッセージが表示される（セキュリティのため）
- ✅ エラーの詳細は表示されない
- ✅ ブラウザのコンソールにエラーログが出力される

**確認ポイント:**
- [ ] ユーザーにはエラーが表示されないか
- [ ] コンソールにエラーログがあるか
- [ ] メールアドレスの存在が推測できないか

---

### テストケース2-4: ヘルプテキストの確認

**手順:**
1. パスワードリセット画面を開く
2. メールを送信する
3. 表示される情報を確認

**期待される結果:**
- ✅ 以下の情報が表示される:

**送信確認:**
```
パスワードリセット用のメールを送信しました。
送信先: [メールアドレス]
```

**操作ガイド:**
```
📧 メール内のリンクをクリック
メール内のリンクをクリックして、新しいパスワードを設定してください。
```

**トラブルシューティング:**
```
⏰ メールが届かない場合
• 迷惑メールフォルダをご確認ください
• メールアドレスが正しいかご確認ください
• 数分待ってから再送信をお試しください
```

**サポート情報:**
```
💡 それでも解決しない場合
お手数ですが、以下の連絡先までお問い合わせください。
サポート: support@example.com
```

**確認ポイント:**
- [ ] すべての情報が表示されているか
- [ ] アイコンが表示されているか
- [ ] 文章がわかりやすいか

---

### テストケース2-5: ログイン画面への戻り

**手順:**
1. パスワードリセット画面を開く
2. 「ログイン画面に戻る」ボタンをクリック

**期待される結果:**
- ✅ ログイン画面に戻る
- ✅ 入力したメールアドレスがクリアされる
- ✅ モーダルが正しく閉じる

---

## テスト3: レスポンシブデザイン

### テストケース3-1: スマートフォン表示

**手順:**
1. ブラウザの開発者ツールを開く
2. デバイスツールバーを有効化（F12 → Ctrl+Shift+M）
3. iPhone SE、iPhone 12 Pro などを選択
4. パスワードリセット画面を表示

**期待される結果:**
- ✅ モーダルが画面に収まる
- ✅ テキストが読みやすい
- ✅ ボタンがタップしやすい
- ✅ スクロールが必要な場合、スムーズにスクロールできる

---

### テストケース3-2: タブレット表示

**手順:**
1. iPad、iPad Pro などを選択
2. パスワードリセット画面を表示

**期待される結果:**
- ✅ レイアウトが適切
- ✅ 余白が適切

---

### テストケース3-3: デスクトップ表示

**手順:**
1. 通常のデスクトップサイズで表示
2. パスワードリセット画面を表示

**期待される結果:**
- ✅ モーダルが中央に配置される
- ✅ 背景がぼやけて表示される（backdrop-blur）
- ✅ レイアウトが美しい

---

## テスト4: ブラウザ互換性

### テストケース4-1: 各ブラウザでの動作確認

**テスト対象:**
- [ ] Google Chrome
- [ ] Mozilla Firefox
- [ ] Safari（Mac/iOS）
- [ ] Microsoft Edge

**確認項目:**
- [ ] モーダルが正しく表示される
- [ ] ボタンが機能する
- [ ] タイマーが動作する
- [ ] アラートが表示される
- [ ] スタイルが崩れていない

---

## テスト5: エッジケース

### テストケース5-1: 連続クリック

**手順:**
1. パスワードリセット画面を開く
2. メールアドレスを入力
3. 「リセットメールを送信」ボタンを連続でクリック

**期待される結果:**
- ✅ ボタンが無効化される（loading状態）
- ✅ 複数回送信されない
- ✅ エラーが発生しない

---

### テストケース5-2: 空のメールアドレス

**手順:**
1. パスワードリセット画面を開く
2. メールアドレスを入力せずに送信ボタンをクリック

**期待される結果:**
- ✅ 「メールアドレスを入力してください」とアラート表示
- ✅ 送信されない

---

### テストケース5-3: 無効なメールアドレス形式

**手順:**
1. パスワードリセット画面を開く
2. 無効な形式のメールアドレスを入力（例: "test"、"test@"）
3. 送信ボタンをクリック

**期待される結果:**
- ✅ ブラウザの標準バリデーションが動作する
- ✅ 「有効なメールアドレスを入力してください」的なメッセージが表示される

---

## デバッグ用のチェックポイント

### コンソールログの確認

**確認すべきログ:**
1. エラーが発生した場合:
   ```
   Password reset error: [エラー詳細]
   ```

2. Supabaseの応答を確認

### ネットワークタブの確認

**確認すべきリクエスト:**
1. `resetPasswordForEmail` のAPIコール
2. レスポンスのステータスコード
3. レスポンスの内容

---

## テスト結果の記録

### テストチェックリスト

#### 重複メール登録
- [ ] テストケース1-1: 新規登録（正常系）
- [ ] テストケース1-2: 重複登録（異常系）
- [ ] テストケース1-3: ログイン

#### パスワードリセット
- [ ] テストケース2-1: メール送信（正常系）
- [ ] テストケース2-2: 再送信機能
- [ ] テストケース2-3: 存在しないメール
- [ ] テストケース2-4: ヘルプテキスト
- [ ] テストケース2-5: 画面遷移

#### レスポンシブ
- [ ] テストケース3-1: スマートフォン
- [ ] テストケース3-2: タブレット
- [ ] テストケース3-3: デスクトップ

#### ブラウザ互換性
- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge

#### エッジケース
- [ ] テストケース5-1: 連続クリック
- [ ] テストケース5-2: 空のメール
- [ ] テストケース5-3: 無効な形式

---

## 問題が見つかった場合

### 報告すべき情報
1. テストケース番号
2. 発生した問題の詳細
3. 期待される動作
4. 実際の動作
5. ブラウザとバージョン
6. スクリーンショット（可能であれば）
7. コンソールのエラーログ

### 報告フォーマット例
```
テストケース: 2-2
問題: 再送信ボタンが有効化されない
期待: 60秒後にボタンが有効化される
実際: ボタンが無効のまま
ブラウザ: Chrome 120.0.0
エラーログ: [コンソールのエラーをコピー]
```

---

## 注意事項

### テスト用メールアドレス
- 実際に受信できるメールアドレスを使用してください
- テスト用のメールアドレスを複数用意することを推奨

### Supabaseの設定
- メール送信が有効になっているか確認
- メールテンプレートが設定されているか確認

### サポートメールアドレス
- 現在は `support@example.com` がハードコードされています
- 実際の運用前に実際のサポートアドレスに変更してください

---

## まとめ

このテストガイドに従って、すべてのテストケースを実行してください。
問題が見つかった場合は、上記のフォーマットで報告してください。

テストが完了したら、`IMPLEMENTATION_LOG_PASSWORD_RESET.md` の「テスト状態」を更新してください。

---

作成日: 2025年12月8日
最終更新: 2025年12月8日


